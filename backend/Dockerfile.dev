# ============================
#  Desarrollo - entorno simple
# ============================
FROM node:22-alpine

# ğŸ§± Activar pnpm
RUN corepack enable && corepack prepare pnpm@9.12.3 --activate

# ğŸ—ï¸ Crear carpeta de trabajo
WORKDIR /app

# ğŸ§© Copiar dependencias bÃ¡sicas
COPY package.json pnpm-lock.yaml* ./

# âš¡ Instalar dependencias (sin --frozen-lockfile en dev, mÃ¡s flexible)
RUN pnpm install

# ğŸ§© Copiar todo el cÃ³digo fuente
COPY . .

# ğŸ”¥ Exponer el puerto
EXPOSE 3001

# Necesarios para entrypoint.sh
RUN apk add --no-cache postgresql-client netcat-openbsd


# ğŸ”¹ Copiar script SQL y entrypoint
COPY ./db /db
COPY ./entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# ğŸ”¹ Comando de arranque
ENTRYPOINT ["/entrypoint.sh"]

# En desarrollo usamos start:dev (hot reload)
CMD ["pnpm", "start:dev"]
